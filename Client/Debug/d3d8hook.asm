; Listing generated by Microsoft (R) Optimizing Compiler Version 15.00.30729.01 

	TITLE	d:\vice-players-master\Client\d3dhook\d3d8hook.cpp
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB LIBCMTD
INCLUDELIB OLDNAMES

PUBLIC	?m_pfnDirect3DCreate8@@3P6GPAUIDirect3D8@@I@ZA	; m_pfnDirect3DCreate8
PUBLIC	?m_pfnDirectInput8Create@@3P6GJPAUHINSTANCE__@@KABU_GUID@@PAPAXPAUIUnknown@@@ZA ; m_pfnDirectInput8Create
_BSS	SEGMENT
?m_pfnDirect3DCreate8@@3P6GPAUIDirect3D8@@I@ZA DD 01H DUP (?) ; m_pfnDirect3DCreate8
?m_pfnDirectInput8Create@@3P6GJPAUHINSTANCE__@@KABU_GUID@@PAPAXPAUIUnknown@@@ZA DD 01H DUP (?) ; m_pfnDirectInput8Create
_BSS	ENDS
PUBLIC	_Direct3DCreate8@4
EXTRN	??0IDirect3D8Hook@@QAE@PAUIDirect3D8@@@Z:PROC	; IDirect3D8Hook::IDirect3D8Hook
EXTRN	??2@YAPAXI@Z:PROC				; operator new
EXTRN	__RTC_CheckEsp:PROC
EXTRN	__RTC_Shutdown:PROC
EXTRN	__RTC_InitBase:PROC
;	COMDAT rtc$TMZ
; File d:\vice-players-master\client\d3dhook\d3d8hook.cpp
rtc$TMZ	SEGMENT
__RTC_Shutdown.rtc$TMZ DD FLAT:__RTC_Shutdown
rtc$TMZ	ENDS
;	COMDAT rtc$IMZ
rtc$IMZ	SEGMENT
__RTC_InitBase.rtc$IMZ DD FLAT:__RTC_InitBase
; Function compile flags: /Odtp /RTCsu /ZI
rtc$IMZ	ENDS
;	COMDAT _Direct3DCreate8@4
_TEXT	SEGMENT
tv74 = -244						; size = 4
$T209553 = -236						; size = 4
$T209554 = -224						; size = 4
_pDeviceHook$ = -20					; size = 4
_pDevice$ = -8						; size = 4
_SDKVersion$ = 8					; size = 4
_Direct3DCreate8@4 PROC					; COMDAT

; 21   : {

	push	ebp
	mov	ebp, esp
	sub	esp, 244				; 000000f4H
	push	ebx
	push	esi
	push	edi
	lea	edi, DWORD PTR [ebp-244]
	mov	ecx, 61					; 0000003dH
	mov	eax, -858993460				; ccccccccH
	rep stosd

; 22   : 	// Create our device
; 23   : 	IDirect3D8 * pDevice = m_pfnDirect3DCreate8(SDKVersion);

	mov	esi, esp
	mov	eax, DWORD PTR _SDKVersion$[ebp]
	push	eax
	call	DWORD PTR ?m_pfnDirect3DCreate8@@3P6GPAUIDirect3D8@@I@ZA ; m_pfnDirect3DCreate8
	cmp	esi, esp
	call	__RTC_CheckEsp
	mov	DWORD PTR _pDevice$[ebp], eax

; 24   : 
; 25   : 	// Create our device hook
; 26   : 	IDirect3D8Hook * pDeviceHook = new IDirect3D8Hook(pDevice);

	push	8
	call	??2@YAPAXI@Z				; operator new
	add	esp, 4
	mov	DWORD PTR $T209554[ebp], eax
	cmp	DWORD PTR $T209554[ebp], 0
	je	SHORT $LN3@Direct3DCr
	mov	eax, DWORD PTR _pDevice$[ebp]
	push	eax
	mov	ecx, DWORD PTR $T209554[ebp]
	call	??0IDirect3D8Hook@@QAE@PAUIDirect3D8@@@Z ; IDirect3D8Hook::IDirect3D8Hook
	mov	DWORD PTR tv74[ebp], eax
	jmp	SHORT $LN4@Direct3DCr
$LN3@Direct3DCr:
	mov	DWORD PTR tv74[ebp], 0
$LN4@Direct3DCr:
	mov	ecx, DWORD PTR tv74[ebp]
	mov	DWORD PTR $T209553[ebp], ecx
	mov	edx, DWORD PTR $T209553[ebp]
	mov	DWORD PTR _pDeviceHook$[ebp], edx

; 27   : 
; 28   : 	// Return the device hook pointer
; 29   : 	return pDeviceHook;

	mov	eax, DWORD PTR _pDeviceHook$[ebp]

; 30   : }

	pop	edi
	pop	esi
	pop	ebx
	add	esp, 244				; 000000f4H
	cmp	ebp, esp
	call	__RTC_CheckEsp
	mov	esp, ebp
	pop	ebp
	ret	4
_Direct3DCreate8@4 ENDP
_TEXT	ENDS
PUBLIC	_DirectInput8Create@20
EXTRN	??0IDirectInput8Hook@@QAE@PAUIDirectInput8A@@@Z:PROC ; IDirectInput8Hook::IDirectInput8Hook
; Function compile flags: /Odtp /RTCsu /ZI
;	COMDAT _DirectInput8Create@20
_TEXT	SEGMENT
tv78 = -244						; size = 4
$T209568 = -236						; size = 4
$T209569 = -224						; size = 4
_pDInput$ = -20						; size = 4
_hr$ = -8						; size = 4
_hinst$ = 8						; size = 4
_dwVersion$ = 12					; size = 4
_riidltf$ = 16						; size = 4
_ppvOut$ = 20						; size = 4
_punkOuter$ = 24					; size = 4
_DirectInput8Create@20 PROC				; COMDAT

; 33   : {

	push	ebp
	mov	ebp, esp
	sub	esp, 244				; 000000f4H
	push	ebx
	push	esi
	push	edi
	lea	edi, DWORD PTR [ebp-244]
	mov	ecx, 61					; 0000003dH
	mov	eax, -858993460				; ccccccccH
	rep stosd

; 34   : 	HRESULT hr = m_pfnDirectInput8Create(hinst, dwVersion, riidltf, ppvOut, punkOuter);

	mov	esi, esp
	mov	eax, DWORD PTR _punkOuter$[ebp]
	push	eax
	mov	ecx, DWORD PTR _ppvOut$[ebp]
	push	ecx
	mov	edx, DWORD PTR _riidltf$[ebp]
	push	edx
	mov	eax, DWORD PTR _dwVersion$[ebp]
	push	eax
	mov	ecx, DWORD PTR _hinst$[ebp]
	push	ecx
	call	DWORD PTR ?m_pfnDirectInput8Create@@3P6GJPAUHINSTANCE__@@KABU_GUID@@PAPAXPAUIUnknown@@@ZA ; m_pfnDirectInput8Create
	cmp	esi, esp
	call	__RTC_CheckEsp
	mov	DWORD PTR _hr$[ebp], eax

; 35   : 	IDirectInput8 * pDInput = (IDirectInput8 *)*ppvOut;

	mov	eax, DWORD PTR _ppvOut$[ebp]
	mov	ecx, DWORD PTR [eax]
	mov	DWORD PTR _pDInput$[ebp], ecx

; 36   : 	*ppvOut = new IDirectInput8Hook(pDInput);

	push	8
	call	??2@YAPAXI@Z				; operator new
	add	esp, 4
	mov	DWORD PTR $T209569[ebp], eax
	cmp	DWORD PTR $T209569[ebp], 0
	je	SHORT $LN3@DirectInpu
	mov	eax, DWORD PTR _pDInput$[ebp]
	push	eax
	mov	ecx, DWORD PTR $T209569[ebp]
	call	??0IDirectInput8Hook@@QAE@PAUIDirectInput8A@@@Z ; IDirectInput8Hook::IDirectInput8Hook
	mov	DWORD PTR tv78[ebp], eax
	jmp	SHORT $LN4@DirectInpu
$LN3@DirectInpu:
	mov	DWORD PTR tv78[ebp], 0
$LN4@DirectInpu:
	mov	ecx, DWORD PTR tv78[ebp]
	mov	DWORD PTR $T209568[ebp], ecx
	mov	edx, DWORD PTR _ppvOut$[ebp]
	mov	eax, DWORD PTR $T209568[ebp]
	mov	DWORD PTR [edx], eax

; 37   : 	return hr;

	mov	eax, DWORD PTR _hr$[ebp]

; 38   : }

	pop	edi
	pop	esi
	pop	ebx
	add	esp, 244				; 000000f4H
	cmp	ebp, esp
	call	__RTC_CheckEsp
	mov	esp, ebp
	pop	ebp
	ret	20					; 00000014H
_DirectInput8Create@20 ENDP
_TEXT	ENDS
PUBLIC	??_C@_0M@ONOEDIJO@dinput8?4dll?$AA@		; `string'
PUBLIC	??_C@_0BD@IJCCAMHG@DirectInput8Create?$AA@	; `string'
PUBLIC	??_C@_08MGNLGFIP@d3d8?4dll?$AA@			; `string'
PUBLIC	??_C@_0BA@EJEHPAKE@Direct3DCreate8?$AA@		; `string'
PUBLIC	?InstallD3D8Hook@@YAXXZ				; InstallD3D8Hook
EXTRN	_DetourFunction@8:PROC
EXTRN	_DetourFindFunction@8:PROC
;	COMDAT ??_C@_0M@ONOEDIJO@dinput8?4dll?$AA@
CONST	SEGMENT
??_C@_0M@ONOEDIJO@dinput8?4dll?$AA@ DB 'dinput8.dll', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BD@IJCCAMHG@DirectInput8Create?$AA@
CONST	SEGMENT
??_C@_0BD@IJCCAMHG@DirectInput8Create?$AA@ DB 'DirectInput8Create', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_08MGNLGFIP@d3d8?4dll?$AA@
CONST	SEGMENT
??_C@_08MGNLGFIP@d3d8?4dll?$AA@ DB 'd3d8.dll', 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_0BA@EJEHPAKE@Direct3DCreate8?$AA@
CONST	SEGMENT
??_C@_0BA@EJEHPAKE@Direct3DCreate8?$AA@ DB 'Direct3DCreate8', 00H ; `string'
; Function compile flags: /Odtp /RTCsu /ZI
CONST	ENDS
;	COMDAT ?InstallD3D8Hook@@YAXXZ
_TEXT	SEGMENT
?InstallD3D8Hook@@YAXXZ PROC				; InstallD3D8Hook, COMDAT

; 41   : {

	push	ebp
	mov	ebp, esp
	sub	esp, 192				; 000000c0H
	push	ebx
	push	esi
	push	edi
	lea	edi, DWORD PTR [ebp-192]
	mov	ecx, 48					; 00000030H
	mov	eax, -858993460				; ccccccccH
	rep stosd

; 42   : 	if(!m_pfnDirect3DCreate8)

	cmp	DWORD PTR ?m_pfnDirect3DCreate8@@3P6GPAUIDirect3D8@@I@ZA, 0 ; m_pfnDirect3DCreate8
	jne	SHORT $LN2@InstallD3D

; 43   : 	{
; 44   : 		m_pfnDirect3DCreate8 = (Direct3DCreate8_t)DetourFunction(DetourFindFunction("d3d8.dll", "Direct3DCreate8"), (PBYTE)Direct3DCreate8);

	push	OFFSET _Direct3DCreate8@4
	push	OFFSET ??_C@_0BA@EJEHPAKE@Direct3DCreate8?$AA@
	push	OFFSET ??_C@_08MGNLGFIP@d3d8?4dll?$AA@
	call	_DetourFindFunction@8
	push	eax
	call	_DetourFunction@8
	mov	DWORD PTR ?m_pfnDirect3DCreate8@@3P6GPAUIDirect3D8@@I@ZA, eax ; m_pfnDirect3DCreate8
$LN2@InstallD3D:

; 45   : 	}
; 46   : 
; 47   : 	if(!m_pfnDirectInput8Create)

	cmp	DWORD PTR ?m_pfnDirectInput8Create@@3P6GJPAUHINSTANCE__@@KABU_GUID@@PAPAXPAUIUnknown@@@ZA, 0 ; m_pfnDirectInput8Create
	jne	SHORT $LN3@InstallD3D

; 48   : 	{
; 49   : 		m_pfnDirectInput8Create = (DirectInput8Create_t)DetourFunction(DetourFindFunction("dinput8.dll", "DirectInput8Create"), (PBYTE)DirectInput8Create);

	push	OFFSET _DirectInput8Create@20
	push	OFFSET ??_C@_0BD@IJCCAMHG@DirectInput8Create?$AA@
	push	OFFSET ??_C@_0M@ONOEDIJO@dinput8?4dll?$AA@
	call	_DetourFindFunction@8
	push	eax
	call	_DetourFunction@8
	mov	DWORD PTR ?m_pfnDirectInput8Create@@3P6GJPAUHINSTANCE__@@KABU_GUID@@PAPAXPAUIUnknown@@@ZA, eax ; m_pfnDirectInput8Create
$LN3@InstallD3D:

; 50   : 	}
; 51   : }

	pop	edi
	pop	esi
	pop	ebx
	add	esp, 192				; 000000c0H
	cmp	ebp, esp
	call	__RTC_CheckEsp
	mov	esp, ebp
	pop	ebp
	ret	0
?InstallD3D8Hook@@YAXXZ ENDP				; InstallD3D8Hook
_TEXT	ENDS
PUBLIC	?UninstallD3D8Hook@@YAXXZ			; UninstallD3D8Hook
EXTRN	_DetourRemove@8:PROC
; Function compile flags: /Odtp /RTCsu /ZI
;	COMDAT ?UninstallD3D8Hook@@YAXXZ
_TEXT	SEGMENT
?UninstallD3D8Hook@@YAXXZ PROC				; UninstallD3D8Hook, COMDAT

; 54   : {

	push	ebp
	mov	ebp, esp
	sub	esp, 192				; 000000c0H
	push	ebx
	push	esi
	push	edi
	lea	edi, DWORD PTR [ebp-192]
	mov	ecx, 48					; 00000030H
	mov	eax, -858993460				; ccccccccH
	rep stosd

; 55   : 	if(m_pfnDirect3DCreate8)

	cmp	DWORD PTR ?m_pfnDirect3DCreate8@@3P6GPAUIDirect3D8@@I@ZA, 0 ; m_pfnDirect3DCreate8
	je	SHORT $LN2@UninstallD

; 56   : 	{
; 57   : 		DetourRemove((PBYTE)m_pfnDirect3DCreate8, (PBYTE)Direct3DCreate8);

	push	OFFSET _Direct3DCreate8@4
	mov	eax, DWORD PTR ?m_pfnDirect3DCreate8@@3P6GPAUIDirect3D8@@I@ZA ; m_pfnDirect3DCreate8
	push	eax
	call	_DetourRemove@8
$LN2@UninstallD:

; 58   : 	}
; 59   : 
; 60   : 	if(m_pfnDirectInput8Create)

	cmp	DWORD PTR ?m_pfnDirectInput8Create@@3P6GJPAUHINSTANCE__@@KABU_GUID@@PAPAXPAUIUnknown@@@ZA, 0 ; m_pfnDirectInput8Create
	je	SHORT $LN3@UninstallD

; 61   : 	{
; 62   : 		DetourRemove((PBYTE)m_pfnDirectInput8Create, (PBYTE)DirectInput8Create);

	push	OFFSET _DirectInput8Create@20
	mov	eax, DWORD PTR ?m_pfnDirectInput8Create@@3P6GJPAUHINSTANCE__@@KABU_GUID@@PAPAXPAUIUnknown@@@ZA ; m_pfnDirectInput8Create
	push	eax
	call	_DetourRemove@8
$LN3@UninstallD:

; 63   : 	}
; 64   : }

	pop	edi
	pop	esi
	pop	ebx
	add	esp, 192				; 000000c0H
	cmp	ebp, esp
	call	__RTC_CheckEsp
	mov	esp, ebp
	pop	ebp
	ret	0
?UninstallD3D8Hook@@YAXXZ ENDP				; UninstallD3D8Hook
_TEXT	ENDS
END
